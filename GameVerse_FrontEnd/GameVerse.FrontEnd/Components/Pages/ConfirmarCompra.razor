@page "/confirmar/{id:int}"
@using GameVerse.FrontEnd.Models
@inject GamesClient GameService
@inject NavigationManager Nav

<h1>Confirmar Compra</h1>

@if (game == null)
{
    <p>Carregando...</p>
}
else
{
    <div class="card p-4">
        <p><strong>Jogo:</strong> @game.Name</p>
        <p><strong>Preço:</strong> @game.Price.ToString("C2")</p>

        @if (!processing)
        {
            <button class="btn btn-primary w-100 mb-2" @onclick="OnConfirmarCompra">
                Confirmar compra
            </button>

            <button class="btn btn-secondary w-100" @onclick="Cancelar">
                Cancelar
            </button>
        }
        else
        {
            <p>Processando...</p>
        }
    </div>
}

@code {
    private GameSummary? game;
    private bool processing = false;

    [Parameter]
    public int id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        game = await GameService.GetByIdAsync(id);
    }

    private Task Cancelar()
    {
        Nav.NavigateTo("");
        return Task.CompletedTask;
    }

    private async Task OnConfirmarCompra()
    {
        if (game is null)
            return;

        processing = true;

        await GameService.BuyGame(game.Id);

        Nav.NavigateTo("compra-sucesso");
    }
}
